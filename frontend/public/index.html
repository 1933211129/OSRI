<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>OSRI指标计算系统</title>
    <script>
      // 在页面加载前就拦截 ResizeObserver 错误，防止 webpack-dev-server overlay 显示
      (function() {
        if (typeof window !== 'undefined') {
          // 1. 拦截 window.onerror
          const originalErrorHandler = window.onerror;
          window.onerror = function(message, source, lineno, colno, error) {
            const msg = (message || '').toString();
            if (/ResizeObserver/i.test(msg)) {
              return true; // 阻止默认错误处理
            }
            if (error && error.message && /ResizeObserver/i.test(error.message)) {
              return true;
            }
            if (originalErrorHandler) {
              return originalErrorHandler.call(this, message, source, lineno, colno, error);
            }
            return false;
          };

          // 2. 拦截全局错误事件（捕获阶段）
          window.addEventListener('error', function(event) {
            const errorMessage = (event.message || (event.error && event.error.message) || '').toString();
            if (/ResizeObserver/i.test(errorMessage)) {
              event.preventDefault();
              event.stopPropagation();
              event.stopImmediatePropagation();
              return false;
            }
          }, true);

          // 3. 拦截 unhandledrejection
          window.addEventListener('unhandledrejection', function(event) {
            if (event.reason) {
              const reasonStr = (event.reason.message || event.reason.toString() || '').toString();
              if (/ResizeObserver/i.test(reasonStr)) {
                event.preventDefault();
                event.stopPropagation();
                return false;
              }
            }
          }, true);

          // 4. 拦截 webpack-dev-server 的 handleError 函数（在它加载后）
          const observer = new MutationObserver(function() {
            if (window.__webpack_dev_server_client__) {
              try {
                const client = window.__webpack_dev_server_client__;
                if (client.default && client.default.handleError) {
                  const originalHandleError = client.default.handleError;
                  client.default.handleError = function(error) {
                    if (error && error.message && /ResizeObserver/i.test(error.message)) {
                      return; // 静默忽略
                    }
                    return originalHandleError.call(this, error);
                  };
                }
              } catch (e) {
                // 忽略拦截失败
              }
            }
            
            // 尝试拦截全局的 handleError
            if (window.handleError) {
              const originalHandleError = window.handleError;
              window.handleError = function(error) {
                if (error && error.message && /ResizeObserver/i.test(error.message)) {
                  return; // 静默忽略
                }
                return originalHandleError.call(this, error);
              };
            }
          });

          // 监听 DOM 变化，等待 webpack-dev-server 加载
          if (document.body) {
            observer.observe(document.body, { childList: true, subtree: true });
          } else {
            document.addEventListener('DOMContentLoaded', function() {
              observer.observe(document.body, { childList: true, subtree: true });
            });
          }

          // 延迟后再次尝试拦截
          setTimeout(function() {
            if (window.handleError && window.handleError.toString().includes('ResizeObserver')) {
              const originalHandleError = window.handleError;
              window.handleError = function(error) {
                if (error && error.message && /ResizeObserver/i.test(error.message)) {
                  return;
                }
                return originalHandleError.call(this, error);
              };
            }
          }, 1000);
        }
      })();
    </script>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but this application doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>

